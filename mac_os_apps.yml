---
- hosts: localhost
  connection: local
  become: false

  pre_tasks:
  - name: Ensuring Homebrew Is Installed
    stat:
      path: /usr/local/bin/brew
    register: homebrew_check

  - name: Fail if homebrew is not installed and install_homebrew_if_missing is False
    fail: 
      msg: Homebrew is missing...Install from https://brew.sh/
    when:
      - not homebrew_check.stat.exists
      - not install_homebrew_if_missing

  - name: Installing Homebrew
    shell: /usr/bin/ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"
    when:
      - not homebrew_check.stat.exists
      - install_homebrew_if_missing 

  tasks:
  - name: Updating Homebrew
    community.general.mas:
      - 1569813296

  # - name: Test
  #   community.general.mas:
  #     - 1569813296
  # - name: Install MAS via BREW
  #   community.general.homebrew:
  #     name: 
  #       - mas

  # - name: Install Mac App Store Apps 
  #   community.general.mas: # Use `mas search 'APP_NAME'` to find id.
  #     - 1569813296 # 1Password for Safari
  #     - 904280696 # Things 3
  #     - 441258766 # Magnet